{"version":3,"file":"index.js","sources":["src/compressImage.js","src/index.js"],"sourcesContent":["function compressImage (imageConfig) {\n  return new Promise(resolve => {\n    const {\n      width,\n      height,\n      quality,\n      src,\n    } = imageConfig;\n    const image = new Image();\n    image.onload = () => {\n      resolve({\n        image,\n        width,\n        height,\n        mimeType: base64MimeType(src),\n        quality,\n      });\n    };\n    if (window.navigator && /(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(window.navigator.userAgent)) {\n      // Fix the `The operation is insecure` error (#57)\n      image.crossOrigin = 'anonymous';\n    }\n    image.src = src;\n  }).then(drawCanvas);\n}\n\nfunction drawCanvas(config) {\n  return new Promise(resolve => {\n    const { image, width, height, mimeType, quality } = config;\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    const context = canvas.getContext('2d');\n    context.fillStyle = 'transparent';\n    context.fillRect(0, 0, width, height);\n    context.save();\n    context.drawImage(image, 0, 0, width, height);\n    context.restore();\n    if (canvas.toBlob) {\n      canvas.toBlob(blob => {\n        const reader = new FileReader();\n        reader.readAsDataURL(blob);\n        reader.onloadend = function() {\n          resolve(reader.result);\n        }\n      }, mimeType, quality);\n    }\n  });\n}\n\nfunction base64MimeType(encoded) {\n  let result = null;\n  if (typeof encoded !== 'string') {\n    return result;\n  }\n  let mime = encoded.match(/data:([a-zA-Z0-9]+\\/[a-zA-Z0-9-.+]+).*,.*/);\n  if (mime && mime.length) {\n    result = mime[1];\n  }\n  return result;\n}\n\nexport default compressImage;\n","/**\n * 参考lottie-compress，压缩包括\n *  数字精度压缩\n *  css属性名压缩\n *  移除默认属性\n *  图片压缩\n *\n */\nimport karas from 'karas';\nimport 'regenerator-runtime';\nimport cloneDeep from 'lodash.clonedeep';\nimport isEqual from 'lodash.isEqual';\nimport get from 'lodash.get';\n\nimport * as innerCompressImage from './compressImage';\n\nconst { DOM, GEOM } = karas.style.reset;\nconst XOM = Object.assign({}, DOM, GEOM);\nconst { isNil, equalArr } = karas.util;\nconst { fullCssProperty, fullAnimate, fullAnimateOption } = karas.parser.abbr;\n\nfunction equalAnimateValue(a, b) {\n  let keyList = [];\n  let keyHash = {};\n  Object.keys(a).forEach(k => {\n    if(k !== 'offset' && !keyHash.hasOwnProperty(k)) {\n      keyList.push(k);\n      keyHash[k] = true;\n    }\n  });\n  for(let i = 0, len = keyList.length; i < len; i++) {\n    let k = keyList[i];\n    if(b.hasOwnProperty(k)) {\n      let va = a[k];\n      let vb = b[k];\n      if(Array.isArray(va) && Array.isArray(vb)) {\n        if(!equalArr(a, b)) {\n          return false;\n        }\n      }\n      else if(Array.isArray(va) || Array.isArray(vb)) {\n        // 异常情况\n        return false;\n      }\n      else if(va !== vb) {\n        return false;\n      }\n    }\n    else {\n      return false;\n    }\n  }\n  let res = true;\n  Object.keys(b).forEach(k => {\n    if(k !== 'offset' && !keyHash.hasOwnProperty(k)) {\n      res = false;\n    }\n  });\n  return res;\n}\n\nfunction isAnimateValueUnavailable(value) {\n  return !value || value.length === 0 || value.length === 1 && Object.keys(value[0]).length === 0;\n}\n\nconst numberPrecisionMapper = {\n  offset: 2,\n  duration: 0,\n  delay: 0,\n  endDelay: 0,\n};\n\n// 默认不压缩图片，处理缩写和重复属性\nconst defaultCompressOption = {\n  image: false,\n  abbr: true,\n  duplicate: true,\n  positionPrecision: 2\n};\n\nclass KarasCompress {\n  constructor(json, options) {\n    let animationJson;\n    if(typeof json === 'string') {\n      try {\n        animationJson = JSON.parse(json);\n      } catch(error) {\n        console.error(error);\n      }\n    }\n    else if(typeof json === 'object') {\n      animationJson = json;\n    }\n    this.animationJson = animationJson;\n    if(!(this.animationJson && typeof this.animationJson === 'object')) {\n      throw new Error('init compress error');\n    }\n    this.options = {\n      quality: options && options.quality || 0.8,\n      compressImage: options && options.compressImage,\n      useCanvasCompress: options && options.useCanvasCompress,\n      ...options,\n    };\n    // init library\n    this.initLibrary();\n  }\n\n  async compress(option = defaultCompressOption) {\n    if(!this.animationJson || typeof this.animationJson !== 'object' || !option) {\n      return this.animationJson;\n    }\n    const {\n      image: needCompressImage,\n      abbr: needAbbr,\n      duplicate: needDuplicate,\n      positionPrecision = 2,\n    } = option;\n    const animationJson = cloneDeep(this.animationJson);\n    this.setPositionPrecision(positionPrecision);\n    let imagesPromise = [];\n    if (needCompressImage) {\n      this.traverseImage(animationJson.library, imagesPromise);\n      this.traverseImage(animationJson.children, imagesPromise);\n      await Promise.all(imagesPromise);\n    }\n    this.traverseJson(animationJson, needAbbr, needDuplicate);\n    this.traverseJson(animationJson.library, needAbbr, needDuplicate);\n    return animationJson;\n  }\n\n  initLibrary() {\n    const library = this.animationJson.library;\n    this.libraryIdMapper = {};\n    this.libraryMapper = {};\n    if (!library || library.length === 0) return;\n    let compressedLibraryId = 0;\n    library.forEach(item => {\n      this.libraryIdMapper[item.id] = compressedLibraryId++;\n      this.libraryMapper[item.id] = item;\n    });\n  }\n\n  setPositionPrecision(value = 0) {\n    ['width', 'height', 'left', 'top'].forEach(key => {\n      numberPrecisionMapper[key] = value;\n    });\n  }\n  traverseImage(children, promiseList) {\n    if(!children || children.length === 0) {\n      return;\n    }\n    children.forEach(item => {\n      // 是否引用library\n      const isRefLibrary = !!(item.libraryId !== undefined && item.init);\n      let isImage = false;\n      let width;\n      let height;\n      let src;\n      if (isRefLibrary) {\n        const library = this.libraryMapper[item.libraryId];\n        width = get(item, 'init.style.width') || get(library, 'props.style.width');\n        height = get(item, 'init.style.height') || get(library, 'props.style.height');\n        src = get(item, 'init.src');\n        isImage = library && library.tagName === 'img' && !!src;\n      } else {\n        width = get(item, 'props.style.width');\n        height = get(item, 'props.style.height');\n        src = get(item, 'props.src');\n        isImage = item.tagName === 'img' && !!src;\n      }\n      if(isImage) {\n        const props = isRefLibrary ? item.init : item.props;\n        if (!props) return;\n        const quality = this.options.quality;\n        const compressImage = this.options.useCanvasCompress\n          ? innerCompressImage\n          : this.options.compressImage;\n        async function asyncCompressImage() {\n          let compressedSrc = src;\n          if (compressImage) {\n            compressedSrc = await compressImage({\n              width,\n              height,\n              src,\n              quality,\n            });\n          }\n          props.src = compressedSrc;\n        }\n        promiseList.push(asyncCompressImage());\n      }\n      else if(item.children && item.children.length > 0) {\n        this.traverseImage(item.children, promiseList);\n      }\n    });\n  }\n\n  traverseJson(json, needAbbr, needDuplicate) {\n    if(!json) {\n      return;\n    }\n    if (Array.isArray(json)) {\n      json.forEach(item => {\n        this.traverseJson(item, needAbbr, needDuplicate);\n      });\n      return;\n    }\n    let { id, libraryId, init, props, animate, children } = json;\n    const isRefLibrary = libraryId !== undefined;\n    if(animate) {\n      animate.forEach((animateItem, index) => {\n        let { value, options } = animateItem;\n        Object.keys(options).forEach(item => {\n          if(needAbbr) {\n            let shortOptionName = this.compressAnimationOptionName(item);\n            let fixedOptionValue = this.cutNumber(options[item], numberPrecisionMapper[item]);\n            delete options[item];\n            options[shortOptionName] = fixedOptionValue;\n          }\n        });\n        Object.keys(animateItem).forEach(item => {\n          if(needAbbr) {\n            let shortName = this.compressAnimateName(item);\n            if(shortName !== item) {\n              animateItem[shortName] = animateItem[item];\n              delete animateItem[item];\n            }\n          }\n        });\n        if(needDuplicate) {\n          let len = value.length;\n          // 去除重复帧，寻找和当前帧样式相同的帧，当跨度>=3时，删除中间的，当跨度2且总长2时保留1个\n          if(len > 2) {\n            for(let i = 0; i < value.length - 2; i++) {\n              let start = value[i];\n              if(equalAnimateValue(start, value[i + 1])) {\n                if(equalAnimateValue(start, value[i + 2])) {\n                  // 直接和最后相等\n                  if(i + 3 === len) {\n                    value.splice(i + 1, 1);\n                    break;\n                  }\n                  else {\n                    let lastEqualIndex = i + 2;\n                    let j = lastEqualIndex + 1;\n                    // 找到不相等的那个索引\n                    for(; j < len; j++) {\n                      if(!equalAnimateValue(start, value[j])) {\n                        break;\n                      }\n                      lastEqualIndex = j;\n                    }\n                    value.splice(i + 1, lastEqualIndex - i - 1);\n                  }\n                  i += 2;\n                }\n                else {\n                  i++;\n                }\n              }\n            }\n          }\n          len = value.length;\n          // 只有2个时重复可去除一个，多个时上面操作可能会变成只有2个情况\n          if(len === 2) {\n            if(equalAnimateValue(value[0], value[1])) {\n              value.splice(1);\n            }\n          }\n          len = value.length;\n          // 去除首尾offset\n          if(len) {\n            delete value[0].offset;\n            delete value[len - 1].offset;\n          }\n        }\n        value && value.forEach(item => {\n          if (needDuplicate) {\n            this.removeDuplicatePropertyInFrame(item, isRefLibrary ? init.style : props.style, libraryId);\n          }\n          if(needAbbr) {\n            this.compressBezier(item);\n          }\n          // 前面已经通过removeDuplicatePropertyInFrame移除了重复的属性，这里不需要处理\n          this.compressCssObject(item, false, needAbbr);\n        });\n        // 经过处理之后animateItem的value是否只有一个空对象，如果是，则移除整个animateItem\n        if (isAnimateValueUnavailable(value)) {\n          animate[index] = null;\n        }\n        // 判断当前animate是否与上一个相同，如果相同，则移除\n        if (isEqual(animate[index], animate[index - 1])) {\n          animate[index] = null;\n        }\n      });\n      const filterAnimate = animate.filter(item => !!item);\n      if (filterAnimate.length === 0) {\n        delete json.animate;\n      } else {\n        json.animate = filterAnimate;\n      }\n    }\n    // id是library内才有的\n    if (!isNil(id)) {\n      json.id = this.libraryIdMapper[id];\n    }\n    // 引用library的item，只有init没有props\n    if (init) {\n      this.compressCssObject(init.style, needDuplicate, needAbbr, libraryId);\n      this.removeDuplicatePropertyInLibrary(init, libraryId, 'points');\n      this.removeDuplicatePropertyInLibrary(init, libraryId, 'controls');\n      if(needAbbr) {\n        if (init.points) init.points = this.cutNumber(init.points);\n        if (init.controls) init.controls = this.cutNumber(init.controls);\n      }\n    }\n    // 引用library，压缩引用ID\n    if (libraryId) {\n      json.libraryId = this.compressLibraryId(libraryId);\n    }\n    if(props) {\n      // 压缩props\n      this.compressCssObject(props.style, needDuplicate, needAbbr);\n      if(needAbbr) {\n        if (props.points) props.points = this.cutNumber(props.points);\n        if (props.controls) props.controls = this.cutNumber(props.controls);\n      }\n    }\n    if(children && Array.isArray(children)) {\n      children.forEach(item => {\n        this.traverseJson(item, needAbbr, needDuplicate);\n      });\n    }\n  }\n\n  compressCssObject(cssObj, canDeleteDefaultProperty = false, canAbbr = false, libraryId) {\n    if(!cssObj) {\n      return;\n    }\n    Object.keys(cssObj).forEach(propertyName => {\n      if (isNil(cssObj[propertyName])) {\n        // 删除空值\n        delete cssObj[propertyName];\n      } else if(canDeleteDefaultProperty) {\n        // 检查默认值\n        // 如果是引用library，则需要判断是否默认值出现在library中\n        // 1.出现在library中且值不为默认值，不能删除\n        // 2.出现在library中且值为默认值，可以删除\n        const libraryItem = this.libraryMapper[libraryId];\n        const libraryStyleCssProperties = libraryItem && libraryItem.props && libraryItem.props.style && libraryItem.props.style[propertyName];\n        const matchDefault = this.checkDefaultProperty(propertyName, cssObj[propertyName]);\n        const libraryMatchDefault = this.checkDefaultProperty(propertyName, libraryStyleCssProperties);\n        const matchLibrary = isEqual(cssObj[propertyName], libraryStyleCssProperties);\n        if (matchLibrary) {\n          delete cssObj[propertyName];\n        } else if (matchDefault && (!libraryId || libraryMatchDefault)) {\n          delete cssObj[propertyName];\n        }\n      }\n      if (canAbbr && !isNil(cssObj[propertyName])) {\n        let shortPropertyName = this.compressCssPropertyName(propertyName);\n        let fixedPropertyValue = this.cutNumber(cssObj[propertyName], numberPrecisionMapper[propertyName]);\n        delete cssObj[propertyName];\n        cssObj[shortPropertyName] = fixedPropertyValue;\n      }\n    });\n  }\n\n  // 移除每帧中属性\n  // 1. 与style重复，则删除\n  // 2. style没有，判断是否为默认属性值，如果是则删除\n  removeDuplicatePropertyInFrame(frame, style, libraryId) {\n    if (!frame) return;\n    const libraryStyle = get(this.libraryMapper, `${libraryId}.props.style`);\n\n    Object.keys(frame).forEach(propertyName => {\n      if (style && !isNil(style[propertyName])) {\n        // style重复\n        if (isEqual(frame[propertyName], style[propertyName])) {\n          delete frame[propertyName];\n        }\n      } else if (libraryStyle && !isNil(libraryStyle[propertyName])) {\n        // 与library重复\n        if (isEqual(frame[propertyName], libraryStyle[propertyName])) {\n          delete libraryStyle[propertyName];\n        }\n      } else {\n        // 判断是否为默认属性值\n        if (this.checkDefaultProperty(propertyName, frame[propertyName])) {\n          delete frame[propertyName];\n        }\n      }\n    });\n  }\n\n  // 移除props与library中相同的属性\n  removeDuplicatePropertyInLibrary(props, libraryId, key) {\n    const libraryProps = get(this.libraryMapper, `${libraryId}.props`);\n    if (!key || !props[key] || !libraryProps[key]) return;\n    if (isEqual(props[key], libraryProps[key])) {\n      delete props[key];\n    }\n  }\n\n  checkDefaultProperty(k, v) {\n    return XOM[k] === v;\n  }\n\n  compressCssPropertyName(propertyName) {\n    const matches = propertyName.match(/^var-(.*)/);\n    if (matches && matches[1]) {\n      return `var-${fullCssProperty[matches[1]] || matches[1]}`;\n    }\n    return fullCssProperty[propertyName] || propertyName;\n  }\n\n  compressAnimateName(itemName) {\n    return fullAnimate[itemName] || itemName;\n  }\n\n  compressAnimationOptionName(optionName) {\n    const matches = optionName.match(/^var-(.*)/);\n    if (matches && matches[1]) {\n      return `var-${fullAnimateOption[matches[1]] || matches[1]}`;\n    }\n    return fullAnimateOption[optionName] || optionName;\n  }\n\n  cutNumber(propertyValue, n) {\n    if(Array.isArray(propertyValue) && propertyValue.length > 0) {\n      // 数组继续递归\n      return propertyValue.map(v => this.cutNumber(v, n));\n    }\n    else if(typeof propertyValue !== 'number') {\n      // 如果不是数字则立即返回原值\n      return propertyValue;\n    }\n    return Number(propertyValue.toFixed(n >= 0 ? n : 4)) || 0;\n  }\n\n  compressBezier(item) {\n    if (!item || !item.easing) return;\n    const matches = item.easing.match(/\\((.*)\\)/);\n    if (matches && matches[1]) {\n      const controls = matches[1].split(',');\n      const fixedControls = controls.map(item => this.cutNumber(item, 3));\n      item.easing = `(${fixedControls.join(',')})`;\n    }\n  }\n\n  compressLibraryId(libraryId) {\n    return this.libraryIdMapper[libraryId] >= 0 ? this.libraryIdMapper[libraryId] : libraryId;\n  }\n}\n\nexport default KarasCompress;\n\n\n\n\n\n"],"names":["compressImage","imageConfig","Promise","resolve","width","height","quality","src","image","Image","onload","mimeType","base64MimeType","window","navigator","test","userAgent","crossOrigin","then","drawCanvas","config","canvas","document","createElement","context","getContext","fillStyle","fillRect","save","drawImage","restore","toBlob","blob","reader","FileReader","readAsDataURL","onloadend","result","encoded","mime","match","length","karas","style","reset","DOM","GEOM","XOM","Object","assign","util","isNil","equalArr","parser","abbr","fullCssProperty","fullAnimate","fullAnimateOption","equalAnimateValue","a","b","keyList","keyHash","keys","forEach","k","hasOwnProperty","push","i","len","va","vb","Array","isArray","res","isAnimateValueUnavailable","value","numberPrecisionMapper","offset","duration","delay","endDelay","defaultCompressOption","duplicate","positionPrecision","KarasCompress","json","options","animationJson","JSON","parse","error","console","Error","useCanvasCompress","initLibrary","option","needCompressImage","needAbbr","needDuplicate","cloneDeep","setPositionPrecision","imagesPromise","traverseImage","library","children","all","traverseJson","libraryIdMapper","libraryMapper","compressedLibraryId","item","id","key","promiseList","isRefLibrary","libraryId","undefined","init","isImage","get","tagName","asyncCompressImage","compressedSrc","props","innerCompressImage","animate","animateItem","index","shortOptionName","compressAnimationOptionName","fixedOptionValue","cutNumber","shortName","compressAnimateName","start","splice","lastEqualIndex","j","removeDuplicatePropertyInFrame","compressBezier","compressCssObject","isEqual","filterAnimate","filter","removeDuplicatePropertyInLibrary","points","controls","compressLibraryId","cssObj","canDeleteDefaultProperty","canAbbr","propertyName","libraryItem","libraryStyleCssProperties","matchDefault","checkDefaultProperty","libraryMatchDefault","matchLibrary","shortPropertyName","compressCssPropertyName","fixedPropertyValue","frame","libraryStyle","libraryProps","v","matches","itemName","optionName","propertyValue","n","map","Number","toFixed","easing","split","fixedControls","join"],"mappings":"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"}